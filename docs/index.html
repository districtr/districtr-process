
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="icon" type="image/png" href="assets/favicon.png">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/default.min.css">
        <script src="scripts/highlight/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>

        <!-- Use CMU Sans-Serif fonts because they're pretty! -->
        <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/dreampulse/computer-modern-web-font/master/fonts.css">
        <style>
            body {
                font-family: "Computer Modern Sans", sans-serif;
                font-size: 16px;
                text-align: justify;
            }

            .container {
                width: 50%;
                margin-left: 25%;
                padding-top: 3em;
                padding-bottom: 3em;
            }

            .img-container {
                margin-top: 1em;
                margin-bottom: 1em;
                width: auto;
                text-align: center;
            }

            h1, h2 {
                text-decoration: underline;
            }

            img {
                width: 75%;
                height: auto;
            }

            ul {
                margin-top: 1em;
                margin-bottom: 1em;
            }

            .broad > li {
                margin-bottom: 0.5em;
            }

            code {
                font-size: .8em;
                padding-left: 0.2em;
                padding-right: 0.2em;
                background-color: #e8e8e8;
            }
        </style>

        <!-- Set a title. -->
        <title>Module Uploads</title>
    </head>

    <body>
        <div class="container">
            <div class="img-container">
                <img src="assets/districtr-logo.jpg"/>
            </div>
            <h1>Module uploads, DistrictR, and you</h1>
            <p>
                Uploading modules to DistrictR is a time-consuming, tedious task
                which requires care, planning, understanding, and consistency
                throughout. The below documentation aims to shed more light on
                the intricacies and pitfalls of module uploading, as well as give
                a broad overview of the DistrictR ecosystem.
            </p>

            <h2>Technical overview</h2>
            <p>
                Behind the scenes, DistrictR leverages its internal raw data stores,
                ambiguous and hard-to-find lists of exceptions, and a number of
                external services to render the map-editing view:

                <ol class="broad">
                    <li>
                        <a href="https://www.mapbox.com/"><strong>Mapbox</strong></a>
                        provides a rich set of geography-as-a-service tools, including
                        tileset storage, tileset management, map rendering, geocoding,
                        and others. DistrictR uses the Mapbox's tileset and map
                        rendering toolkit to store and retrieve specific sets of
                        geographic data (e.g. Census Blocks, VTDs, etc.) and render
                        them to the map-editing view when requested.
                    </li>
                    <li>
                        <a href="https://github.com/districtr/districtr/tree/latest/assets/data/modules">
                        <strong>Internal module storage</strong></a> contains a
                        <code>.json</code> file for each state; this <code>.json</code>
                        file contains a list of JSON objects which define
                        <i>modules</i>, individual jurisdictions for which users
                        draw districting plans. For example, the <code>California.json</code>
                        file (clocking in at nearly 30,000 lines of raw data)
                        contains a number of important items for each module,
                        including:
                        <ul>
                            <li>Mapbox tileset URLs;</li>
                            <li>module-wide population and demographic information;</li>
                            <li>the type(s) of districting plan to be drawn with the module;</li>
                            <li>many more.</li>
                        </ul>
                    </li>
                    <li>
                        <a href="https://aws.amazon.com/lambda/"><strong>AWS Lambda,</strong></a>
                        which provides "serverless" code execution; ensuring that
                        DistrictR's Lambda functions execute properly relies on
                        the careful <i>naming</i> and <i>placement</i> of specific
                        files, which will be reviewed later.
                    </li>
                </ol>
                Largely, these three components – Mapbox, internal module storage,
                and AWS – make the DistrictR map-editing view tick. There are,
                however, <i>far</i> more components that contribute to DistrictR's
                operation, handily summarized in this flow chart:
                <div class="img-container">
                    <img src="assets/flow-chart.png"/>
                    <p style="font-size: 0.8em; font-style: italic">
                        The use of the word "handily" is tongue-in-cheek; "handy"
                        or "clear" are not words which describe the above.
                    </p>
                </div>
            </p>

            <h2>Editing DistrictR Code</h2>
            <p>
                After you've used districtr-process to upload your tileset to 
                Mapbox, you have to edit the DistrictR code to let it know where to
                find the tileset on Mapbox and how to interpret it. Additionally, 
                you have to configure a number of settings for each module, such as
                whether to display it on the state's landing page or what options
                you want on the plan drawing page.
            </p>
            <h3><i>Copying from output.json</i></h3>
            <p>
                The first step is putting the JSON output from
                <code>districtr-process</code> in the appropriate JSON file in 
                the DistrictR code. When you run <code>districtr-process</code> 
                on a YAML file (or files), it writes some JSON code to 
                <code>output.json</code>. This code will be a list of JSON objects,
                with each object corresponding to a YAML file you ran 
                <code>districtr-process</code> on. How you transfer this JSON from
                <code>output.json</code> to the Distrctr JSON depends on the nature
                of your task.
            </p>
            <h4>New Module</h4>
            <p>
                If this is a new module (i.e. there are no other sets of units for
                this region on Distrctr), then you'll need to copy the full JSON
                object, including the module id, name, and districting problem(s).
                Find your module's state JSON in <code>assets/data/modules</code>
                (e.g. <code>California.json</code>). Each of these state JSONs is
                simply a list of JSON objects like the ones produced by
                <code>districtr-process</code>. Add yours to the list.
            </p>
            <h4>Existing Module</h4>
            <p>
                If the module already exists on DistrictR, then you probably only
                need to add a new set of units to the existing module. In this case,
                you need to copy the item corresponding to your new units from
                the <code>units</code> array in <code>output.json</code>. Find the
                module you're updating in the appropriate state JSON (e.g. 
                <code>assets/data/modules/California.json</code>) and paste the
                item you copied into that module's <code>units</code> array.
            </p>
            <h3><i>Configuring DistrictR</i></h3>
            <p>
                This section is split into three parts: New Module, Existing 
                Module, and General.
            </p>
            <h4>New Module</h4>
            <p>
                <code>landing_pages.json</code>: If you'd like the new module to
                appear on the state's landing page (e.g. 
                <code>district.org/California</code>), add your module's ID to the
                appropriate list in <code>landing_pages.json</code>. These lists
                of modules are separated into state, counties and cities, where
                modules for those exist.
            </p>
            <h4>Existing Module</h4>
            <p>
                <code>"hideOnDefault"</code>: You probably don't want the old units
                to show up on the state's landing page by default, now that there
                are new units. To hide the old units, add 
                <code>"hideOnDefault": true</code> to the old units in the module
                in your state's JSON.
            </p>

            <h2>Self-QA</h2>
            <p>The following is a non-exhaustive list of baseline QA checks you can perform on your module:
                <ul>
                    <li></li>
                </ul>
            </p>
            <p></p>
        </div>
    </body>
</html>
